<!DOCTYPE html>
<html lang="en">
<head>
  <%- include("includes/head", {
    title: "Dream Dictionary A–Z | DreamBook",
    description: "Search and explore dream meanings from A to Z using the DreamBook dictionary.",
    canonical: "/dictionary"
  }) %>
</head>

<body class="dictionary-page">

<%- include("includes/header") %>

<main class="wrapper">
  <h1>Dream Dictionary A–Z</h1>

  <p>Explore our dream dictionary to discover the meanings of your dreams.</p>
  <section>
<h2>Add dream meanings</h2>
<form action="/dictionary" method="POST" class="dream-analyzer-form"></form>
<label for="add-dream">Add a new dream meaning:</label>
<input type="term" id="add-dream" name="term" placeholder="e.g. unicorn, treasure, fire" required>
<textarea id="meaning" name="meaning" placeholder="Enter the dream meaning here..." required></textarea>
<button class="btn" type="submit">Add Dream Meaning</button>

  </section>

  <section>
    <h2>Search Dream Meanings</h2>

    <form id="searchForm" action="/dictionary" method="POST">
      <label for="search">Enter a dream symbol:</label>
      <input type="text" id="search" name="term" placeholder="e.g. snake, water, flying" required>
      <button class="btn" type="submit">Search</button>
    </form>

    <ul id="liveResults"></ul>

    <% if (typeof results !== "undefined" && results.length) { %>
      <h3>Search Results</h3>
      <ul>
        <% results.forEach(r => { %>
          <li>
            <a href="/dream-dictionary/<%= r.term.toLowerCase() %>">
              <strong><%= r.term %></strong> Dream Meaning
            </a>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </section>

  <section>
    <h2>Browse A–Z</h2>
    <div class="alphabet-list">
      <% "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => { %>
        <a href="/dictionary/<%= l %>"><%= l %></a>
      <% }) %>
    </div>
  </section>
</main>

<%- include("includes/footer") %>

<script>
const input = document.getElementById("search");
const resultsBox = document.getElementById("liveResults");
let timer;

input.addEventListener("input", () => {
  clearTimeout(timer);
  const q = input.value.trim();
  if (!q) return resultsBox.innerHTML = "";

  timer = setTimeout(async () => {
    const res = await fetch("/dictionary/live?q=" + encodeURIComponent(q));
    const data = await res.json();

    resultsBox.innerHTML = data.map(d =>
      `<li>
        <a href="/dream-dictionary/${d.term.toLowerCase()}">
          <strong>${d.term}</strong> Dream Meaning
        </a>
      </li>`
    ).join("");
  }, 300);
});
</script>

</body>
</html>
