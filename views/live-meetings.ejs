<!DOCTYPE html>
<html lang="<%= lang %>">
<head>
  <%- include('includes/head') %>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <%- include('includes/header') %>

  <div class="container" style="margin-top:40px;">
    <h1>Live Group Meetings</h1>

    <!-- creation form -->
    <div class="mb-4">
      <h2>Create a New Meeting</h2>
      <% if (newMeeting) { %>
        <div class="alert alert-success">
          Meeting created! ID: <code><%= newMeeting.id %></code><br>
          Link: <a href="<%= newMeeting.meeting_link %>" target="_blank"><%= newMeeting.meeting_link %></a>
        </div>
      <% } %>

      <% if (preLink) { %>
        <div class="alert alert-secondary">
          <strong>New meeting ID (not yet saved):</strong>
          <code><%= preId %></code><br>
          <strong>Link:</strong>
          <a href="<%= preLink %>" target="_blank"><%= preLink %></a>
          <p class="small text-muted">You can copy this and send to participants now; it will be used when the meeting is created.</p>
        </div>
      <% } %>

      <form action="/live-meetings/create" method="post">
        <input type="hidden" name="preId" value="<%= preId %>">
        <div class="form-group">
          <label for="title">Title</label>
          <input type="text" name="title" id="title" class="form-control" required>
        </div>
        <div class="form-group mt-2">
          <label for="description">Description</label>
          <textarea name="description" id="description" class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group mt-2">
          <label for="scheduled_at">Start time</label>
          <input type="datetime-local" name="scheduled_at" id="scheduled_at" class="form-control">
        </div>
        <div class="form-group mt-2">
          <label for="duration">Duration (minutes)</label>
          <input type="number" name="duration" id="duration" class="form-control" value="60" min="1">
        </div>
        <button class="btn btn-primary mt-3" type="submit">Create meeting</button>
      </form>
    </div>

    <hr>

    <div>
      <h2>Existing Meetings</h2>
      <% if (meetings && meetings.length) { %>
        <ul class="list-group">
          <% meetings.forEach(m => { %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong><%= m.title %></strong>
                <% if (m.creator_username) { %>by <%= m.creator_username %><% } %>
                <% const start = m.scheduled_at || m.new_date; %>
                <% if (start) { %> â€“ <%= new Date(start).toLocaleString() %><% } %>
                <% if (m.status) { %> [<%= m.status %>]<% } %>
              </div>
              <div>
                <span class="small text-muted">ID: <%= m.id %></span>
                <% if (m.meeting_link) { %>
                  <a href="<%= m.meeting_link %>" class="btn btn-sm btn-success ml-2" target="_blank">Join</a>
                <% } %>
              </div>
            </li>
          <% }); %>
        </ul>
      <% } else { %>
        <p>No meetings scheduled.</p>
      <% } %>
    </div>
  </div>
</body>
</html>