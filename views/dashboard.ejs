<!DOCTYPE html>
<html lang="en">
<head>
  <%- include("includes/head") %>

  <!-- Prevent indexing -->
  <meta name="robots" content="noindex, follow">
</head>

<body>

  <%- include("includes/header") %>

  <main class="wrapper page-wrapper dashboard-page">
    <h1>Community Dream Posts</h1>

    <div class="posts-list">
      <% if (posts.length) { %>
        <% posts.forEach(post => { %>
          <article class="post-card">
            <h2><%= post.username %></h2>
            <p><%- post.body %></p>

            <div class="reactions">
              ğŸ‘ <%= countReactions.get(post.id)?.likes || 0 %>
              ğŸ‘ <%= countReactions.get(post.id)?.dislikes || 0 %>
            </div>

            <small>
              Posted on <%= new Date(post.createdDate).toLocaleDateString() %>
            </small>

            <a href="/post/<%= post.id %>" class="btn">Read Interpretation</a>

            <% if (user && Number(post.authorid) === Number(user.id)) { %>
              <form action="/delete-post/<%= post.id %>" method="POST" style="display:inline;">
                <button type="submit" class="btn danger">Delete</button>
              </form>
            <% } %>
          </article>
        <% }) %>
      <% } else { %>
        <p>No dreams have been shared yet.</p>
      <% } %>
    </div>

    <nav class="pagination">
      <% if (currentPage > 1) { %>
        <a href="/dashboard?page=<%= currentPage - 1 %>">Previous</a>
      <% } %>

      <% for (let i = 1; i <= totalPages; i++) { %>
        <% if (i === currentPage) { %>
          <strong><%= i %></strong>
        <% } else { %>
          <a href="/dashboard?page=<%= i %>"><%= i %></a>
        <% } %>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <a href="/dashboard?page=<%= currentPage + 1 %>">Next</a>
      <% } %>
    </nav>
  </main>

</body>
  <%- include("includes/footer") %>
</html>
