<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('includes/head') %>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<h1>Admin Dashboard</h1>
<form action="/admin" method="get">
  <button type="submit" class="btn">Refresh Stats</button>

<% if (visitCount !== undefined) { %></form>
  <div class="admin-stat">
    <h4>Total Website Visits</h4>
    <p><%= visitCount %></p>
  </div>
<% } %>

<% if (userCount !== undefined) { %>
  <div class="admin-stat">
    <h4>Total Registered Users</h4>
    <p><%= userCount %></p>
  </div>
  </form>

<% } %>
<% if (postCount !== undefined) { %>
  <div class="admin-stat">
    <h4>Total Dreams Posted</h4>
    <p><%= postCount %></p>
  </div>
<% } %>
<% if (commentCount !== undefined) { %>
  <div class="admin-stat">
    <h4>Total Comments Made</h4>
    <p><%= commentCount %></p>
  </div>
<% } %>
<% if (activeUsers !== undefined) { %>
  <div class="admin-stat">
    <h4>Active Users (Last 24 hrs)</h4>
    <p><%= activeUsers %></p>
  </div>
<% } %>
<% if (postsLastWeek !== undefined) { %>
  <div class="admin-stat">
    <h4>Dreams Posted (Last 7 days)</h4>
    <p><%= postsLastWeek %></p>
  </div>
<% } %>
<% if (commentsLastWeek !== undefined) { %>
  <div class="admin-stat">
    <h4>Comments Made (Last 7 days)</h4>
    <p><%= commentsLastWeek %></p>
  </div>
<% } %>
<% if (mostActiveUser !== undefined) { %>
  <div class="admin-stat">
    <h4>Most Active User (Last 7 days)</h4>
    <p><%= mostActiveUser.username %> (<%= mostActiveUser.activityCount %> actions)</p>
  </div>
<% } %>
<% if (mostPostedDreamsUser !== undefined) { %>
  <div class="admin-stat">
    <h4>User with Most Dreams Posted</h4>
    <p><%= mostPostedDreamsUser.username %> (<%= mostPostedDreamsUser.postCount %> dreams)</p>
  </div>
<% } %>
<% if (mostCommentedUser !== undefined) { %>
  <div class="admin-stat">
    <h4>User with Most Comments Made</h4>
    <p><%= mostCommentedUser.username %> (<%= mostCommentedUser.commentCount %> comments)</p>
  </div>

<% } %>
<% if (latestUsers && latestUsers.length) { %>
  <div class="admin-stat">
    <h4>Latest Registered Users</h4>
    <ul>
      <% latestUsers.forEach(user => { %>
        <li><%= user.username %> (Joined: <%= new Date(user.createdAt).toLocaleDateString() %>)</li>
      <% }) %>
    </ul>
  </div>
<% } %>
<% if (latestPosts && latestPosts.length) { %>
  <div class="admin-stat">
    <h4>Latest Dreams Posted</h4>
    <ul>
      <% latestPosts.forEach(post => { %>
        <li><%= post.username %>: "<%= post.body.length > 30 ? post.body.substring(0, 30) + '...' : post.body
  %>" (Posted: <%= new Date(post.createdDate).toLocaleDateString() %>)</li>
      <% }) %>
    </ul>
  </div>
<% } %>
<% if (latestComments && latestComments.length) { %>
  <div class="admin-stat">
    <h4>Latest Comments Made</h4>
    <ul>
      <% latestComments.forEach(comment => { %>
        <li><%= comment.authorUsername %>: "<%= comment.body.length > 30 ? comment.body.substring(0, 30) + '...' : comment.body
  %>" (Commented: <%= new Date(comment.createdDate).toLocaleDateString() %>)</li>
      <% }) %>
    </ul>
  </div>
<% } %>
</body>

