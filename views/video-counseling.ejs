<!DOCTYPE html>
<html lang="<%= lang %>">
<head>
  <%- include('includes/head') %>
  <link rel="stylesheet" href="/style.css">
  <style>
    .dashboard-section {
      margin-bottom: 30px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .dashboard-section h2 {
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .buttons {
      display: flex;
      gap: 10px;
    }

    .videos {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    video {
      width: 300px;
      background: #000;
      border-radius: 10px;
    }

    .documents {
      margin-top: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .document-card {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 200px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
  </style>
</head>
<body>
  <%- include("includes/header") %>

  <div class="container">

    <!-- ================= Group Meetings ================= -->
    <div class="dashboard-section" id="group-meetings">
      <h2>
        ðŸ”µ Live Group Meetings
        <div class="buttons">
          <a href="/create-group-meeting" class="btn btn-primary">Create Session</a>
          <a href="/join-group-meeting" class="btn btn-success">Join Session</a>
        </div>
      </h2>

      <div class="videos" id="group-video-container">
        <!-- Live group meeting video streams inserted here via Socket.IO -->
      </div>

      <div class="documents">
        <% if(groupDocuments && groupDocuments.length) { %>
          <% groupDocuments.forEach(doc => { %>
            <div class="document-card">
              <strong><%= doc.name %></strong>
              <div>
                <a href="<%= doc.url %>" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                <% if(isAdmin) { %>
                  <a href="/documents/<%= doc.id %>/edit" class="btn btn-sm btn-outline-warning">Edit</a>
                  <a href="/documents/<%= doc.id %>/download" class="btn btn-sm btn-outline-success">Download</a>
                <% } %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p>No documents yet.</p>
        <% } %>
      </div>
    </div>

    <!-- ================= 1-to-1 Counseling ================= -->
    <div class="dashboard-section" id="one-to-one-counseling">
      <h2>
        ðŸŸ¢ 1-to-1 Counseling
        <div class="buttons">
          <a href="/create-counseling-session" class="btn btn-primary">Schedule Session</a>
          <a href="/join-counseling-session" class="btn btn-success">Join Session</a>
        </div>
      </h2>

      <div class="videos" id="counseling-video-container">
        <!-- 1-to-1 video streams inserted here via Socket.IO -->
      </div>

      <div class="documents">
        <% if(counselingDocuments && counselingDocuments.length) { %>
          <% counselingDocuments.forEach(doc => { %>
            <div class="document-card">
              <strong><%= doc.name %></strong>
              <div>
                <a href="<%= doc.url %>" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
                <% if(isAdmin) { %>
                  <a href="/documents/<%= doc.id %>/edit" class="btn btn-sm btn-outline-warning">Edit</a>
                  <a href="/documents/<%= doc.id %>/download" class="btn btn-sm btn-outline-success">Download</a>
                <% } %>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <p>No documents yet.</p>
        <% } %>
      </div>
    </div>

  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // ================= Group Meeting Videos =================
    const groupContainer = document.getElementById('group-video-container');
    socket.on('group-video-update', participants => {
      groupContainer.innerHTML = '';
      participants.forEach(p => {
        const vid = document.createElement('video');
        vid.srcObject = p.stream; // Assumes stream is sent via WebRTC
        vid.autoplay = true;
        vid.playsInline = true;
        groupContainer.appendChild(vid);
      });
    });

    // ================= 1-to-1 Counseling Videos =================
    const counselingContainer = document.getElementById('counseling-video-container');
    socket.on('counseling-video-update', participants => {
      counselingContainer.innerHTML = '';
      participants.forEach(p => {
        const vid = document.createElement('video');
        vid.srcObject = p.stream;
        vid.autoplay = true;
        vid.playsInline = true;
        counselingContainer.appendChild(vid);
      });
    });
  </script>
</body>
</html>