<!DOCTYPE html>
<html lang="en">
<head>
  <%- include("includes/head") %>
  <meta name="robots" content="index, follow">
</head>

<body class="single-post-page">
<%- include("includes/header") %>

<main class="wrapper page-wrapper">
  <article class="post-card">

    <h1><%= post.title %></h1>

    <%
      const postDate = post.createdDate ? new Date(post.createdDate) : null;
      const isValidDate = postDate && !isNaN(postDate.getTime());
    %>

    <p class="post-date">
      Dream shared by <strong><%= post.username %></strong>
      on
      <time datetime="<%= isValidDate ? postDate.toISOString() : '' %>">
        <%= isValidDate ? postDate.toLocaleDateString() : "createdDate" %>
      </time>
    </p>

    <div class="post-body">
      <%- post.body %>
    </div>

    <!-- Reactions -->
    <form style="font-size:24px" action="/post/<%= post.id %>/reactions" method="POST">
      <button name="reaction" value="like">ğŸ‘ Like</button>
      <button name="reaction" value="dislike">ğŸ‘ Dislike</button>
      <button type="button"
        onclick="document.getElementById('new-comment-form').classList.toggle('hidden')">
        ğŸ’¬ Comment
      </button>
    </form>

    <div class="reactions">
      ğŸ‘ <%= reactions?.likes || 0 %>
      â€¢ ğŸ‘ <%= reactions?.dislikes || 0 %>
      â€¢ ğŸ’¬ <%= comments?.length || 0 %> comments
    </div>
  </article>

  <!-- Comments -->
  <section id="comment-section">
    <h2>Dream Interpretations & Comments</h2>

    <% if (user) { %>
      <form id="new-comment-form" class="comment-form hidden"
            action="/post/<%= post.id %>/comment" method="POST">
        <textarea name="body" required placeholder="Share your interpretation..."></textarea>
        <button type="submit">Post Comment</button>
        <button type="button"
          onclick="document.getElementById('new-comment-form').classList.add('hidden')">
          Cancel
        </button>
      </form>
    <% } %>

    <% (comments || []).forEach(comment => { %>
      <div class="comment" id="comment-<%= comment.id %>">
        <strong><%= comment.authorUsername %></strong>
        <p><%= comment.body %></p>
      </div>
    <% }) %>
  </section>
</main>

<%- include("includes/footer") %>
</body>
</html>
