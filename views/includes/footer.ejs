<footer>
  <small>&copy; eDreamBook_2025</small>
</footer>

<!-- Socket.io -->
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

<script>
  /* =========================
     SOCKET NOTIFICATIONS
  ========================= */
  // use a separate variable so we can also create a meeting socket on the same page
  const notifSocket = io();
  notifSocket.emit("join_room", "user_<%= user ? user.id : '' %>");

  notifSocket.on("new_message", data => {
    const badge = document.getElementById("notif-count");
    if (badge) badge.textContent = Number(badge.textContent) + 1;

    if (Notification.permission === "granted") {
      new Notification(`New message from ${data.sendername}`, { body: data.body });
    }
  });

  async function loadUnread() {
    const badge = document.getElementById("notif-count");
    if (!badge) return;
    const res = await fetch("/notifications/unread-count");
    const json = await res.json();
    badge.textContent = json.count;
  }

  loadUnread();
</script>

<script>
  /* =========================
     MOBILE NAV TOGGLE
  ========================= */
  const toggleBtn = document.getElementById("menuToggle");
  const navLinks = document.getElementById("navLinks");

  toggleBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = navLinks.classList.toggle("active");
    toggleBtn.setAttribute("aria-expanded", isOpen);
    navLinks.setAttribute("aria-hidden", !isOpen);
    document.body.classList.toggle("nav-open", isOpen);
  });

  /* =========================
     ACCOUNT DROPDOWN
  ========================= */
  const accountBtn = document.getElementById("accountBtn");
  const accountMenu = document.getElementById("accountMenu");

  accountBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = accountMenu.classList.toggle("active");
    accountBtn.setAttribute("aria-expanded", isOpen);
    accountMenu.setAttribute("aria-hidden", !isOpen);
  });

  /* =========================
     CLOSE MENUS ON OUTSIDE CLICK
  ========================= */
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".dropdown")) {
      accountMenu?.classList.remove("active");
      accountBtn?.setAttribute("aria-expanded", "false");
      accountMenu?.setAttribute("aria-hidden", "true");
    }

    if (!e.target.closest("#navLinks") && !e.target.closest("#menuToggle")) {
      navLinks?.classList.remove("active");
      toggleBtn?.setAttribute("aria-expanded", "false");
      navLinks?.setAttribute("aria-hidden", "true");
      document.body.classList.remove("nav-open");
    }
  });
</script>
</body>
</html>
