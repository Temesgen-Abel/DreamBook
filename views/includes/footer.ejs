<footer>
  <small>&copy; DreamBook_2025</small>
</footer>

<!-- Socket.io -->
<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>

<script>
  /* =========================
     SOCKET NOTIFICATIONS
  ========================= */
  const socket = io("http://localhost:5733");

  socket.emit("join_room", "user_<%= user ? user.id : '' %>");

  socket.on("new_message", data => {
    const badge = document.getElementById("notif-count");
    if (badge) badge.textContent = Number(badge.textContent) + 1;

    if (Notification.permission === "granted") {
      new Notification(`New message from ${data.sendername}`, {
        body: data.body
      });
    }
  });

  async function loadUnread() {
    const badge = document.getElementById("notif-count");
    if (!badge) return;

    const res = await fetch("/notifications/unread-count");
    const json = await res.json();
    badge.textContent = json.count;
  }

  loadUnread();
</script>

<script>
  /* =========================
     MOBILE NAV TOGGLE
  ========================= */
  const toggleBtn = document.getElementById("menuToggle");
  const navLinks = document.getElementById("navLinks");

  toggleBtn?.addEventListener("click", (e) => {
  e.stopPropagation();

  const isOpen = navLinks.classList.toggle("active");

  toggleBtn.setAttribute("aria-expanded", isOpen);
  navLinks.setAttribute("aria-hidden", !isOpen);

  // ðŸ”¥ prevents page scrolling / overlap
  document.body.classList.toggle("nav-open", isOpen);
});


  /* =========================
     ACCOUNT DROPDOWN (FIXED)
  ========================= */
  const accountBtn = document.getElementById("accountBtn");
  const accountMenu = document.getElementById("accountMenu");

  accountBtn?.addEventListener("click", (e) => {
    e.stopPropagation(); // ðŸ”¥ critical fix
    const isOpen = accountMenu.classList.toggle("active");
    accountBtn.setAttribute("aria-expanded", isOpen);
    accountMenu.setAttribute("aria-hidden", !isOpen);
  });

  /* =========================
     CLOSE MENUS ON OUTSIDE CLICK
  ========================= */
  document.addEventListener("click", () => {
    navLinks?.classList.remove("active");
    toggleBtn?.setAttribute("aria-expanded", "false");
    navLinks?.setAttribute("aria-hidden", "true");

    accountMenu?.classList.remove("active");
    accountBtn?.setAttribute("aria-expanded", "false");
    accountMenu?.setAttribute("aria-hidden", "true");
  });
</script>

</body>
</html>
